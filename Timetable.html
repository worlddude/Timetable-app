<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Circular Timetable — Scheduled Blocks</title>
<style>
  :root {
    --bg: #0f1221;
    --card: #14182b;
    --text: #e8ebff;
    --muted: #b9c0ff;
    --ring: #222748;
    --accent: #7c82ff;
    --tick: rgba(255,255,255,.65);
    --gap: #475569;
  }
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }
  .wrap { max-width: 1100px; margin: 24px auto; padding: 16px; display: grid; gap: 16px; grid-template-columns: 1fr; }
  @media (min-width: 1024px) { .wrap { grid-template-columns: 500px 1fr; align-items: start; } }

  .phone, .panel {
    background: var(--card);
    border-radius: 20px;
    padding: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.05);
  }
  .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
  .header h1 { font-size: 18px; margin: 0; }
  .sub { color: var(--muted); font-size: 12px; }

  .chart { display: grid; place-items: center; padding: 4px 0; }
  #chartHost { position: relative; width: 380px; height: 380px; }
  .center-label {
    position: absolute; left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }
  .center-label .big { font-size: 26px; font-weight: 800; }
  .center-label .small { color: var(--muted); font-size: 12px; }

  .legend { display: grid; gap: 6px; grid-template-columns: 1fr 1fr; margin-top: 10px; }
  .legend .item {
    display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--muted);
    background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.06);
    border-radius: 10px; padding: 6px 8px;
  }
  .swatch { width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(255,255,255,.25); }

  .row { display: flex; align-items: center; gap: 10px; }
  .row button {
    background: rgba(255,255,255,.06); color: var(--text);
    border: 1px solid rgba(255,255,255,.2);
    border-radius: 10px; padding: 8px 10px; font-weight: 600;
  }
  .row button.primary {
    background: var(--accent); border-color: var(--accent); color: #fff;
    box-shadow: 0 6px 16px rgba(124,130,255,.35);
  }

  table { width: 100%; border-collapse: collapse; font-size: 14px; }
  th, td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,.06); }
  th { text-align: left; color: var(--muted); font-weight: 600; font-size: 12px; }

  td input[type="text"], td input[type="time"], td input[type="color"] {
    width: 100%; background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    color: var(--text); padding: 8px 10px; border-radius: 8px;
  }
  input[type="time"]::-webkit-calendar-picker-indicator {
    filter: invert(1);
  }
  .minutesCell { color: #fff; font-weight: 600; }
  .pill { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; padding: 6px 10px; font-size: 12px; font-weight: 700; }
  .ok { background: rgba(134,239,172,.12); color: #86efac; border: 1px solid rgba(134,239,172,.35); }
  .warn { background: rgba(253,224,71,.10); color: #fde047; border: 1px solid rgba(253,224,71,.35); }
  .err { background: rgba(253,164,175,.10); color: #fda4af; border: 1px solid rgba(253,164,175,.35); }
</style>
</head>
<body>
<div class="wrap">
  <div class="phone">
    <div class="header">
      <div>
        <h1>Plan your day</h1>
        <p class="sub">24-hour time format</p>
      </div>
    </div>
    <div class="chart">
      <div id="chartHost"></div>
      <div class="center-label">
        <div class="big">24h</div>
        <div class="small" id="timeLabel">—:—</div>
      </div>
    </div>
    <div class="legend" id="legend"></div>
  </div>

  <div class="panel">
    <div class="row" style="justify-content: space-between; margin-bottom: 8px;">
      <h2 style="margin:0">Scheduled Blocks</h2>
      <div id="totals"></div>
    </div>
    <table id="tbl">
      <thead>
        <tr>
          <th style="width:30%">Label</th>
          <th style="width:16%">Start</th>
          <th style="width:16%">End</th>
          <th style="width:14%">Minutes</th>
          <th style="width:16%">Color</th>
          <th style="width:12%"></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <div class="row" style="margin-top:10px;">
      <button id="addRowBtn" type="button" class="primary">+ Add block</button>
    </div>
  </div>
</div>

<script>
const palette = ["#8b5cf6","#06b6d4","#22c55e","#f59e0b","#ef4444","#3b82f6"];
let blocks = [
  { label:"Sleep", start:"22:00", end:"07:00", color: palette[0] },
  { label:"Work", start:"08:30", end:"16:30", color: palette[1] },
  { label:"Gym", start:"17:00", end:"18:00", color: palette[2] }
];

function parseHHMM(str){ if(!str) return 0; const [h,m]=str.split(":").map(Number); return h*60+m; }
function fmtHHMM(min){ const h=Math.floor(min/60)%24, m=min%60; return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`; }
function calcMinutes(b){ const s=parseHHMM(b.start), e=parseHHMM(b.end); return (e-s+1440)%1440; }
function minutesToHM(min){ const h=Math.floor(min/60), m=min%60; return (h?`${h}h `:"")+(m?`${m}m`:""); }

function renderTable(){
  const tbody=document.getElementById("tbody");
  tbody.innerHTML="";
  blocks.forEach((b,i)=>{
    const tr=document.createElement("tr");

    const tdLabel=document.createElement("td");
    const inLabel=document.createElement("input");
    inLabel.type="text"; inLabel.value=b.label;
    inLabel.oninput=()=>{b.label=inLabel.value; renderLegend();};
    tdLabel.appendChild(inLabel);

    const tdStart=document.createElement("td");
    const inStart=document.createElement("input");
    inStart.type="time"; inStart.value=b.start||"08:00"; inStart.step=60;
    inStart.lang="en-GB"; // ✅ force 24h
    inStart.addEventListener("input",()=>{
      b.start=inStart.value;
      tdMin.textContent=minutesToHM(calcMinutes(b));
      renderLegend();
    });
    tdStart.appendChild(inStart);

    const tdEnd=document.createElement("td");
    const inEnd=document.createElement("input");
    inEnd.type="time"; inEnd.value=b.end||"09:00"; inEnd.step=60;
    inEnd.lang="en-GB"; // ✅ force 24h
    inEnd.addEventListener("input",()=>{
      b.end=inEnd.value;
      tdMin.textContent=minutesToHM(calcMinutes(b));
      renderLegend();
    });
    tdEnd.appendChild(inEnd);

    const tdMin=document.createElement("td");
    tdMin.className="minutesCell";
    tdMin.textContent=minutesToHM(calcMinutes(b));

    const tdColor=document.createElement("td");
    const inColor=document.createElement("input");
    inColor.type="color"; inColor.value=b.color;
    inColor.oninput=()=>{b.color=inColor.value; renderLegend();};
    tdColor.appendChild(inColor);

    const tdActions=document.createElement("td");
    const del=document.createElement("button");
    del.textContent="✕";
    del.onclick=()=>{blocks.splice(i,1); render();};
    tdActions.appendChild(del);

    tr.append(tdLabel,tdStart,tdEnd,tdMin,tdColor,tdActions);
    tbody.appendChild(tr);
  });
}

function renderLegend(){
  const leg=document.getElementById("legend");
  leg.innerHTML="";
  blocks.forEach(b=>{
    const row=document.createElement("div");
    row.className="item";
    row.innerHTML=`<span class="swatch" style="background:${b.color}"></span>
      <span>${b.label} <span style="color:#fff">${b.start}</span>–<span style="color:#fff">${b.end}</span></span>
      <span style="margin-left:auto;color:#fff">${minutesToHM(calcMinutes(b))}</span>`;
    leg.appendChild(row);
  });
}

document.getElementById("addRowBtn").onclick=()=>{
  const now=new Date();
  const start=fmtHHMM(now.getHours()*60+now.getMinutes());
  const end=fmtHHMM((parseHHMM(start)+60)%1440);
  const nextColor=palette[blocks.length%palette.length];
  blocks.push({label:"New Block",start,end,color:nextColor});
  render();
};

function render(){
  renderTable();
  renderLegend();
}
render();
</script>
</body>
</html>
